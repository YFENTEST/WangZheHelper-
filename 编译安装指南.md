# ç‹è€…è£è€€å¿«é€Ÿå……å€¼åŠ©æ‰‹ - ç¼–è¯‘å®‰è£…æŒ‡å—

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. å®‰è£… Theos (åœ¨ macOS/Linux)

```bash
# è®¾ç½® Theos è·¯å¾„
export THEOS=~/theos

# å…‹éš† Theos
git clone --recursive https://github.com/theos/theos.git $THEOS

# å°† THEOS æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
echo "export THEOS=~/theos" >> ~/.bashrc  # æˆ– ~/.zshrc
source ~/.bashrc  # æˆ– ~/.zshrc
```

### 2. å®‰è£… iOS SDK

```bash
# ä¸‹è½½å¹¶è§£å‹ iOS SDK
# ä» https://github.com/theos/sdks ä¸‹è½½å¯¹åº”çš„ SDK
cd $THEOS/sdks
git clone https://github.com/theos/sdks.git ./
```

### 3. å®‰è£…ç¼–è¯‘å·¥å…·

```bash
# macOS (éœ€è¦ Xcode Command Line Tools)
xcode-select --install

# Linux (Ubuntu/Debian)
sudo apt-get install clang build-essential fakeroot git perl
```

### 4. é…ç½® SSH è¿æ¥åˆ°è®¾å¤‡

```bash
# ç¡®ä¿è®¾å¤‡å·²è¶Šç‹±å¹¶å®‰è£…äº† OpenSSH
# é»˜è®¤å¯†ç é€šå¸¸æ˜¯ "alpine"

# æµ‹è¯•è¿æ¥
ssh root@è®¾å¤‡IP
```

## ğŸ”¨ ç¼–è¯‘æ­¥éª¤

### æ–¹æ³•ä¸€: ç›´æ¥ç¼–è¯‘å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/wangzhehelper

# 2. æ¸…ç†ä¹‹å‰çš„ç¼–è¯‘æ–‡ä»¶
make clean

# 3. ç¼–è¯‘é¡¹ç›®
make

# 4. æ‰“åŒ… deb
make package

# 5. å®‰è£…åˆ°è®¾å¤‡ï¼ˆéœ€è¦ SSH è¿æ¥ï¼‰
# æ–¹å¼ A: è‡ªåŠ¨å®‰è£…
make install THEOS_DEVICE_IP=è®¾å¤‡IP THEOS_DEVICE_PORT=22

# æ–¹å¼ B: æ‰‹åŠ¨å®‰è£…
# deb æ–‡ä»¶ä¼šåœ¨ packages/ ç›®å½•ä¸‹
# ä½¿ç”¨ scp æˆ– Filza å¤åˆ¶åˆ°è®¾å¤‡å¹¶å®‰è£…
```

### æ–¹æ³•äºŒ: åˆ†æ­¥éª¤ç¼–è¯‘

```bash
# 1. ç¼–è¯‘ä¸» Tweak
make clean
make

# 2. ç¼–è¯‘ Preferences Bundle
cd wzhelperprefs
make clean
make
cd ..

# 3. æ‰“åŒ…
make package

# 4. æŸ¥çœ‹ç”Ÿæˆçš„ deb åŒ…
ls -lh packages/
```

## ğŸ“± å®‰è£…åˆ°è®¾å¤‡

### æ–¹æ³•ä¸€: é€šè¿‡ make install

```bash
# ç¡®ä¿è®¾å¤‡é€šè¿‡ WiFi/USB è¿æ¥ï¼Œå¹¶ä¸”å·²å¯ç”¨ SSH
make install THEOS_DEVICE_IP=192.168.1.100 THEOS_DEVICE_PORT=22
```

### æ–¹æ³•äºŒ: æ‰‹åŠ¨å®‰è£…

```bash
# 1. æ‰¾åˆ°ç”Ÿæˆçš„ deb æ–‡ä»¶
ls packages/com.yourname.wangzhehelper_*.deb

# 2. å¤åˆ¶åˆ°è®¾å¤‡
scp packages/com.yourname.wangzhehelper_*.deb root@è®¾å¤‡IP:/var/root/

# 3. SSH åˆ°è®¾å¤‡å¹¶å®‰è£…
ssh root@è®¾å¤‡IP
dpkg -i /var/root/com.yourname.wangzhehelper_*.deb
killall -9 SpringBoard
```

### æ–¹æ³•ä¸‰: é€šè¿‡ Filza

1. å°† `packages/` ç›®å½•ä¸‹çš„ `.deb` æ–‡ä»¶ä¼ è¾“åˆ°è®¾å¤‡
2. ä½¿ç”¨ Filza æ‰“å¼€ `.deb` æ–‡ä»¶
3. ç‚¹å‡»å³ä¸Šè§’çš„"å®‰è£…"
4. ç­‰å¾…å®‰è£…å®Œæˆåæ³¨é”€è®¾å¤‡

## ğŸ”§ å¸¸è§ç¼–è¯‘é—®é¢˜

### é—®é¢˜ 1: æ‰¾ä¸åˆ° Theos

```bash
# é”™è¯¯ä¿¡æ¯: make: /makefiles/common.mk: No such file or directory

# è§£å†³æ–¹æ³•: è®¾ç½® THEOS ç¯å¢ƒå˜é‡
export THEOS=~/theos
# æˆ–åœ¨ Makefile ä¸­å–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½® THEOS è·¯å¾„
```

### é—®é¢˜ 2: SDK ç‰ˆæœ¬é—®é¢˜

```bash
# é”™è¯¯ä¿¡æ¯: unable to find SDK

# è§£å†³æ–¹æ³•: æ£€æŸ¥ SDK æ˜¯å¦å®‰è£…
ls $THEOS/sdks/

# æˆ–ä¿®æ”¹ Makefile ä¸­çš„ TARGET ä¸ºå·²å®‰è£…çš„ SDK ç‰ˆæœ¬
TARGET := iphone:clang:13.0:11.0
```

### é—®é¢˜ 3: æƒé™é—®é¢˜

```bash
# é”™è¯¯ä¿¡æ¯: Permission denied

# è§£å†³æ–¹æ³•: æ·»åŠ æ‰§è¡Œæƒé™
chmod +x $THEOS/bin/*
```

### é—®é¢˜ 4: SSH è¿æ¥å¤±è´¥

```bash
# é”™è¯¯ä¿¡æ¯: Connection refused

# è§£å†³æ–¹æ³•:
# 1. ç¡®ä¿è®¾å¤‡å·²å®‰è£… OpenSSH
# 2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
# 3. ç¡®è®¤ IP åœ°å€æ­£ç¡®
# 4. å°è¯•æ‰‹åŠ¨ SSH è¿æ¥æµ‹è¯•
ssh root@è®¾å¤‡IP
```

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹ Bundle ID

ç¼–è¾‘ `control` æ–‡ä»¶ï¼š

```
Package: com.yourname.wangzhehelper  # æ”¹æˆä½ çš„åŒ…å
Maintainer: Your Name <your.email@example.com>
```

åŒæ—¶ä¿®æ”¹ `Makefile` ä¸­çš„ç›¸å…³é…ç½®ã€‚

### ä¿®æ”¹å……å€¼æ¡£ä½

ç¼–è¾‘ `Tweak.x`ï¼Œæ‰¾åˆ° `setupRechargeOptions` æ–¹æ³•ï¼š

```objective-c
NSArray *products = @[
    @{@"title": @"60ç‚¹åˆ¸", @"productId": @"com.tencent.smoba60_60", @"price": @6.0},
    // æ·»åŠ æˆ–ä¿®æ”¹æ¡£ä½...
];
```

### ä¿®æ”¹æ‚¬æµ®æŒ‰é’®æ ·å¼

åœ¨ `Tweak.x` çš„ `addFloatingButton` æ–¹æ³•ä¸­ä¿®æ”¹ï¼š

```objective-c
floatingButton.backgroundColor = [UIColor colorWithRed:0.2 green:0.6 blue:1.0 alpha:0.9];
[floatingButton setTitle:@"ğŸ’" forState:UIControlStateNormal];  // ä¿®æ”¹å›¾æ ‡
```

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# SSH åˆ°è®¾å¤‡
ssh root@è®¾å¤‡IP

# æŸ¥çœ‹æ’ä»¶æ—¥å¿—
tail -f /var/log/syslog | grep WZHelper

# æˆ–ä½¿ç”¨æ›´è¯¦ç»†çš„æ—¥å¿—
deviceconsole | grep WZHelper
```

### é‡æ–°åŠ è½½æ’ä»¶

```bash
# SSH åˆ°è®¾å¤‡åæ‰§è¡Œ
killall -9 SpringBoard

# æˆ–åªæ€æ‰ç‹è€…è£è€€è¿›ç¨‹
killall -9 smoba
```

### æ£€æŸ¥æ’ä»¶æ˜¯å¦åŠ è½½

```bash
# SSH åˆ°è®¾å¤‡
ssh root@è®¾å¤‡IP

# æŸ¥çœ‹å·²åŠ è½½çš„åŠ¨æ€åº“
ls -la /Library/MobileSubstrate/DynamicLibraries/

# åº”è¯¥çœ‹åˆ°:
# WangZheHelper.dylib
# WangZheHelper.plist
```

## ğŸ“¦ å‘å¸ƒ deb åŒ…

### 1. ä¿®æ”¹ç‰ˆæœ¬å·

ç¼–è¾‘ `control` æ–‡ä»¶ï¼š

```
Version: 1.0.1  # æ›´æ–°ç‰ˆæœ¬å·
```

### 2. ç¼–è¯‘å¹¶æ‰“åŒ…

```bash
make clean
make package
```

### 3. ç”Ÿæˆçš„æ–‡ä»¶

```
packages/com.yourname.wangzhehelper_1.0.1_iphoneos-arm.deb
```

### 4. ä¸Šä¼ åˆ°ä»“åº“

å¦‚æœä½ æœ‰è‡ªå·±çš„ Cydia/Sileo ä»“åº“ï¼Œå¯ä»¥ä¸Šä¼  deb åŒ…ã€‚

## ğŸ”„ æ›´æ–°æ’ä»¶

### æœ¬åœ°æ›´æ–°

```bash
# 1. ä¿®æ”¹ä»£ç 
# 2. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆcontrol æ–‡ä»¶ï¼‰
# 3. é‡æ–°ç¼–è¯‘
make clean
make package

# 4. å®‰è£…æ–°ç‰ˆæœ¬
make install THEOS_DEVICE_IP=è®¾å¤‡IP
```

### ç”¨æˆ·æ›´æ–°

ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ›´æ–°ï¼š

1. ä»ä»“åº“æ›´æ–°ï¼ˆå¦‚æœå·²å‘å¸ƒï¼‰
2. æ‰‹åŠ¨ä¸‹è½½æ–°çš„ deb åŒ…å®‰è£…
3. ä½¿ç”¨ Filza å®‰è£…æ–°ç‰ˆæœ¬

## ğŸ¯ Windows ç”¨æˆ·

Windows ç”¨æˆ·å¯ä»¥ä½¿ç”¨ WSL (Windows Subsystem for Linux) è¿›è¡Œç¼–è¯‘ï¼š

```bash
# 1. å®‰è£… WSL2
wsl --install

# 2. åœ¨ WSL ä¸­å®‰è£… Theosï¼ˆæŒ‰ç…§ Linux æ­¥éª¤ï¼‰
# 3. æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ç¼–è¯‘

# æ³¨æ„: ç”Ÿæˆçš„ deb æ–‡ä»¶åœ¨ WSL æ–‡ä»¶ç³»ç»Ÿä¸­
# å¯ä»¥é€šè¿‡ \\wsl$ è®¿é—®
```

## ğŸ“š ç›¸å…³èµ„æº

- [Theos å®˜æ–¹æ–‡æ¡£](https://theos.dev/docs/)
- [iOS è¶Šç‹±å¼€å‘æ•™ç¨‹](https://iphonedev.wiki/)
- [Cydia Substrate æ–‡æ¡£](http://www.cydiasubstrate.com/id/264d6581-a762-4343-9605-729ef12ff0af/)

## ğŸ’¡ å¼€å‘æŠ€å·§

### å¿«é€Ÿè¿­ä»£

åˆ›å»ºä¸€ä¸ªç¼–è¯‘å®‰è£…è„šæœ¬ `build.sh`ï¼š

```bash
#!/bin/bash
make clean
make package
make install THEOS_DEVICE_IP=ä½ çš„è®¾å¤‡IP
```

```bash
chmod +x build.sh
./build.sh
```

### è¿œç¨‹æ—¥å¿—æŸ¥çœ‹

åˆ›å»º `log.sh`ï¼š

```bash
#!/bin/bash
ssh root@ä½ çš„è®¾å¤‡IP "tail -f /var/log/syslog" | grep WZHelper
```

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ GitHub æäº¤ Issueã€‚

